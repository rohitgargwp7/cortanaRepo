<phone:PhoneApplicationPage 
    x:Class="windows_client.View.ChatThread"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    xmlns:controls="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls"
    xmlns:c4fToolkit="clr-namespace:Coding4Fun.Phone.Controls;assembly=Coding4Fun.Phone.Controls"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    SupportedOrientations="Portrait" Orientation="Portrait"
    mc:Ignorable="d" d:DesignHeight="800" d:DesignWidth="480"
    shell:SystemTray.IsVisible="False" Visibility="Visible" Name="chatThreadMainPage">

    <phone:PhoneApplicationPage.Resources>
        <Style x:Key="ListBoxItemStretchContentStyle" TargetType="ListBoxItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        </Style>
    </phone:PhoneApplicationPage.Resources>

    <!--LayoutRoot is the root grid where all page content is placed-->
    <Grid x:Name="LayoutRoot" Background="White">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!--TitlePanel contains the name of the application and page title-->
        <StackPanel x:Name="HikeTitle" Orientation="Vertical" HorizontalAlignment="Left" Width="480">
            <StackPanel Orientation="Vertical" Margin="23,0,55,0">
                <Image  Margin="0,20,0,15" HorizontalAlignment="Left" Height="34" Width="127">
                    <Image.Source>
                        <BitmapImage UriSource="images\hike_logo_small.png" CreateOptions="BackgroundCreation"></BitmapImage>
                    </Image.Source>
                </Image>
                <StackPanel Orientation="Horizontal">
                    <Border BorderThickness="2" BorderBrush="Black">
                        <Image Name="userImage" Source="images\ic_avatar0.png" Width="65" Height="65"></Image>
                    </Border>
                    <StackPanel Orientation="Vertical" Height="65">
                        <TextBlock x:Name="userName" Text="Madhur Garg" FontSize="34" Height="44" Margin="18,-4,0,0" Width="Auto" Foreground="Black"/>
                        <!--<TextBlock x:Name="typeNotification" FontSize="18" Text="Typing..." Height="32" Margin="18,0,0,0" Width="Auto" Foreground="Black"/>-->
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <!--ContentPanel - place additional content here-->
        <ListBox x:Name="myListBox" Grid.Row="1" VerticalAlignment="Bottom" Grid.ColumnSpan="2" ItemContainerStyle="{StaticResource ListBoxItemStretchContentStyle}" 
                 FontSize="26" Margin="0,0,0,95" Tap="chatListBox_tap">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Vertical">
                        <Border BorderBrush="Gray" Margin="0,5,0,5" BorderThickness="3" Width="400" Visibility="{Binding NotificationMessageVisiblity}">
                            <StackPanel Orientation="Horizontal" Width="380" Margin="15,0,0,0" Visibility="{Binding NotificationMessageVisiblity}">
                                <Image Source="images\ic_hike_user.png"></Image>
                                <TextBlock Text="{Binding Message}" Foreground="Black" Margin="4,0,0,0" FontSize="22"></TextBlock>
                            </StackPanel>
                        </Border>

                        <StackPanel Orientation="Horizontal" Height="Auto"  VerticalAlignment="Stretch" HorizontalAlignment="{Binding Alignment}" 
                                  Margin="20,5,20,15"  Grid.RowSpan="2" Visibility="{Binding ChatBubbleVisiblity}">
                            <Image Margin="0,0,8,0" Visibility="{Binding SdrImageVisibility}" HorizontalAlignment="Right">
                                <Image.Source>
                                    <BitmapImage UriSource="{Binding SdrImage}" CreateOptions="BackgroundCreation"></BitmapImage>
                                </Image.Source>
                            </Image>
                            <c4fToolkit:ChatBubble  ChatBubbleDirection="{Binding ChatBubbleDirection}" Background="{Binding BubbleBackground}">
                                <StackPanel Width="315" Orientation="Vertical">
                                    <RichTextBox Tag="{Binding Message}" Foreground="Black" TextWrapping="Wrap" MaxWidth="360" Loaded="RichTextBox_Loaded" Margin="{Binding ChatBubbleMargin}"/>
                                    <!--<TextBlock Text="{Binding Message}" TextWrapping="Wrap" MaxWidth="360" Margin="{Binding ChatBubbleMargin}"/>-->
                                    <TextBlock FontSize="15" Margin="0,2,15,2" Height="25" HorizontalAlignment="Right" Foreground="Black" Text="{Binding ChatTimeFormat}"/>
                                </StackPanel>
                                <toolkit:ContextMenuService.ContextMenu>
                                    <toolkit:ContextMenu Name="ctxMenu">
                                        <toolkit:MenuItem Header="Copy"  Tap="MenuItem_Tap_Copy"/>
                                        <toolkit:MenuItem Header="Forward"  Tap="MenuItem_Tap_Forward"/>
                                        <toolkit:MenuItem Header="Delete"  Tap="MenuItem_Tap_Delete"/>
                                    </toolkit:ContextMenu>
                                </toolkit:ContextMenuService.ContextMenu>
                            </c4fToolkit:ChatBubble>

                            <!--<StackPanel Orientation="Vertical">
                            <StackPanel Orientation="Horizontal" Background="{Binding BubbleBackground}">

                                <StackPanel Orientation="Vertical">
                                    <RichTextBox Tag="{Binding Message}" TextWrapping="Wrap" MaxWidth="360" Loaded="RichTextBox_Loaded" Margin="{Binding ChatBubbleMargin}"/>
                                    <TextBlock FontSize="15" Height="25" Margin="0,2,15,2" HorizontalAlignment="Right" Foreground="Black" Text="{Binding ChatTimeFormat}"/>
                                </StackPanel>
                                
                                <toolkit:ContextMenuService.ContextMenu>
                                    <toolkit:ContextMenu Name="ctxMenu">
                                        <toolkit:MenuItem Header="Copy"  Tap="MenuItem_Tap_Copy"/>
                                        <toolkit:MenuItem Header="Forward"  Tap="MenuItem_Tap_Forward"/>
                                        <toolkit:MenuItem Header="Delete"  Tap="MenuItem_Tap_Delete"/>
                                    </toolkit:ContextMenu>
                                </toolkit:ContextMenuService.ContextMenu>
                            </StackPanel>
                        </StackPanel>-->
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        <StackPanel x:Name="bottomPanel" Height="Auto" Grid.Row="1" Orientation="Vertical" VerticalAlignment="Bottom" Background="White">
            <StackPanel Visibility="Collapsed" x:Name="emoticonPanel" LostFocus="emoticonPanel_LostFocus" Background="#eeeeec">
                <ListBox Width="Auto" Height="Auto" Name="optionsList" Tap="optionsList_Tap">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <toolkit:WrapPanel/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.Items>
                        <ListBoxItem >
                            <StackPanel Orientation="Horizontal" >
                                <StackPanel Orientation="Vertical" Width="150" >
                                    <Image Margin="3" Height="50">
                                        <Image.Source>
                                            <BitmapImage UriSource="images\emoticons\emo_im_01_bigsmile.png" CreateOptions="BackgroundCreation"></BitmapImage>
                                        </Image.Source>
                                    </Image>
                                    <Rectangle Fill="Blue" Height="4" Width="Auto"></Rectangle>
                                </StackPanel>
                                <Rectangle Fill="Black" Width="3" Height="Auto" Margin="3,8,3,8"></Rectangle>
                            </StackPanel>
                        </ListBoxItem>
                        <ListBoxItem>
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Orientation="Vertical" Width="150">
                                    <Image Margin="3" Height="50">
                                        <Image.Source>
                                            <BitmapImage UriSource="images\emoticons\emo_im_102_scorn.png" CreateOptions="BackgroundCreation"></BitmapImage>
                                        </Image.Source>
                                    </Image>
                                    <Rectangle Fill="Blue" Height="4" Width="Auto"></Rectangle>
                                </StackPanel>
                                <Rectangle Fill="Black" Width="3" Height="Auto" Margin="3,8,3,8"></Rectangle>
                            </StackPanel>
                        </ListBoxItem>
                        <ListBoxItem>
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Orientation="Vertical" Width="150">
                                    <Image Margin="3" Height="50">
                                        <Image.Source>
                                            <BitmapImage UriSource="images\emoticons\emo_im_111_grin.png" CreateOptions="BackgroundCreation"></BitmapImage>
                                        </Image.Source>

                                    </Image>
                                    <Rectangle Fill="Blue" Height="4" Width="Auto"></Rectangle>
                                </StackPanel>
                            </StackPanel>
                        </ListBoxItem>
                    </ListBox.Items>
                </ListBox>

                <controls:Pivot x:Name="emoticonPivot" Grid.Row="1" Foreground="Black" Height="220">
                    <controls:PivotItem Margin="12,8,12,0">
                        <Grid x:Name="emotGrid0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="460"></ColumnDefinition>
                            </Grid.ColumnDefinitions>

                            <ListBox Height="200" Name="emotList0" Grid.Row="0" Grid.Column="0" Visibility="Visible" BorderThickness="18,0,0,0" Tap="emotList0_Tap">
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <toolkit:WrapPanel ItemHeight="60" ItemWidth="60"/>
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>

                                <ListBox.ItemTemplate>

                                    <DataTemplate>
                                        <Image Margin="8,6,8,6" Height="40" Width="40" Source="{Binding}">
                                        </Image>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </controls:PivotItem>

                    <controls:PivotItem CacheMode="BitmapCache" BorderThickness="0" VerticalAlignment="Top" Height="220" Margin="12,8,12,0">
                        <Grid x:Name="emotGrid1" Margin="18,0,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                            </Grid.ColumnDefinitions>

                            <ListBox Name="emotList1" Height="200" Grid.Row="0" Grid.Column="0" Visibility="Visible" Tap="emotList1_Tap">
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <toolkit:WrapPanel ItemHeight="60" ItemWidth="60"/>
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>

                                <ListBox.ItemTemplate>

                                    <DataTemplate>
                                        <Image Margin="8,6,8,6" Height="40" Width="40" Source="{Binding}">
                                        </Image>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                        </Grid>
                    </controls:PivotItem>

                    <controls:PivotItem Margin="12,8,12,0">
                        <Grid x:Name="emotGrid2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                            </Grid.ColumnDefinitions>

                            <ListBox Height="200" Name="emotList2" Grid.Row="0" Grid.Column="0" Visibility="Visible" Tap="emotList2_Tap">
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <toolkit:WrapPanel ItemHeight="60" ItemWidth="60"/>
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>

                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Image Margin="8,6,8,6" Height="40" Width="40" Source="{Binding}">
                                        </Image>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </controls:PivotItem>
                </controls:Pivot>
            </StackPanel>

            <Image x:Name="typingNotification" Source="images\typing.png" Visibility="Visible" Opacity="0" Height="20" Width="30" HorizontalAlignment="Left" Margin="20,5,0,5"></Image>
            <Rectangle Width="Auto" Height="2" Margin="0,0,0,0" Fill="#dedede"/>
            <StackPanel Background="#eeeeec">
                <toolkit:PhoneTextBox Background="#eeeeec" BorderThickness="0" x:Name="sendMsgTxtbox" GotFocus="sendMsgTxtbox_GotFocus" AcceptsReturn="True" Hint=""  Width="480" TextWrapping="Wrap" TextChanged="sendMsgTxtbox_TextChanged" MinHeight="68" Margin="0,-4,-8,0" Height="Auto" VerticalAlignment="Top"/>
            </StackPanel>
        </StackPanel>
        <toolkit:PerformanceProgressBar x:Name="progressBar" Grid.Row="1" Margin="0,0,0,0" Background="#FFF2F6F8" IsIndeterminate="True" Foreground="Black" VerticalAlignment="Center" VerticalContentAlignment="Center" FontSize="24" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" IsEnabled="False" IsTabStop="True" Visibility="Collapsed"/>

        <StackPanel x:Name="OverlayMessagePanel" Visibility="Collapsed" Opacity="1" Grid.Row="1" Height="280" VerticalAlignment="Top" Margin="25,20,25,0" Orientation="Vertical">
            <Image Source="images\ic_block_active.png" Height="40"></Image>
            <TextBlock HorizontalAlignment="Center" Margin="15,10,15,0" TextAlignment="Center" TextWrapping="Wrap" Text="You have blocked this user. Unblock to continue hiking" Foreground="#FFFFFF" FontSize="32"></TextBlock>
            <Button Background="#0d5585" Height="75" Content="Unblock" Width="250" Margin="0,10,0,0" Click="blockUnblock_Click"></Button>
        </StackPanel>
    </Grid>
</phone:PhoneApplicationPage>
